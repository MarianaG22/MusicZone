<h1>Perfil de Usuario</h1>

<!-- Secci칩n para editar datos personales -->
<section>
    <h2>Editar Datos Personales</h2>
    <form method="POST" action="{% url 'users:edit_user' request.user.id %}">
        {% csrf_token %}
        <label for="username">Nombre de usuario:</label>
        <input type="text" id="username" name="username" value="{{ request.user.username }}" required><br>

        <label for="email">Correo electr칩nico:</label>
        <input type="email" id="email" name="email" value="{{ request.user.email }}" required><br>

        <label for="name">Nombre:</label>
        <input type="text" id="name" name="name" value="{{ request.user.name }}" required><br>

        <label for="last_name">Apellido:</label>
        <input type="text" id="last_name" name="last_name" value="{{ request.user.last_name }}" required><br>

        <label for="password">Nueva contrase침a (opcional):</label>
        <input type="password" id="password" name="password"><br>

        <button type="submit">Guardar cambios</button>
    </form>
</section>

<!-- Secci칩n para el historial de compras -->
<section>
    <h2>Historial de Compras</h2>
    {% if orders %}
    <table>
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Total</th>
                <th>Estado</th>
                <th>Detalles</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td>{{ order.order_date }}</td>
                <td>${{ order.sale.total_price }}</td>
                <td>{{ order.status }}</td>
                <td>
                    <button onclick="toggleDetails('details-{{ order.id }}')">Ver Detalles</button>
                </td>
            </tr>
            <tr id="details-{{ order.id }}" style="display: none;">
                <td colspan="4">
                    <h4>Detalles del Pedido</h4>
                    <ul>
                        {% for detail in order.sale.sale_detail_set.all %}
                        <li>
                            {{ detail.instrument.instrument }} - Cantidad: {{ detail.quantity }} - Precio: ${{ detail.price }}
                        </li>
                        {% endfor %}
                    </ul>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No tienes compras registradas.</p>
    {% endif %}
</section>

<script>
    function toggleDetails(id) {
        const element = document.getElementById(id);
        if (element.style.display === "none") {
            element.style.display = "table-row";
        } else {
            element.style.display = "none";
        }
    }
</script>